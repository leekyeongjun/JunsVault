# 메모리의 구조

- 비트를 그룹화하여 더 많은 값을 저장할 수 있다.  
	- 8비트 = 1바이트  
	- 16비트 = 2바이트 = 1개의 하프워드  
	- 32비트 = 4바이트 = 1단어  
- 소프트웨어 관점에서 메모리는 어드레스 가능한 바이트 배열이다.

# 메모리의 aligning

- 32비트 (4바이트) 기준 
	- 끝자리는 4의 배수여야 한다.
- 2바이트 기준이라면?
	- 끝자리는 2의 배수여야 한다.
![[Pasted image 20231017233410.png]]

# 메모리 맵

- 메모리 맵은 메모리, 시스템 및 I/Operipheral을 포함하는 하드웨어 구성 요소의 어드레스 공간 레이아웃을 설명한다  
- Cortex-M3 프로세서의 주소 공간은 총 4GB이다.  
	- 4GB의 물리적 메모리가 있는 건 아니다. 
	  
- Cortex-M3 프로세서에는 고정 메모리 맵이 있다.  
	- Cortex-M3 제품 간에 간편한 소프트웨어 포팅을 가능하게 한다.
	- 예를 들어, NVIC(Nested Vectored Interrupt Controller)와 MPU(Memory Protection Unit)는 모든 Cortex-M3 제품에서 동일한 메모리 위치를 가진다
	  
![[Pasted image 20231017233656.png]]
- 메모리 맵은 또한 각 메모리 블록 또는 장치에 액세스하는 메모리 속성을 정의한다.
- Cortex-M3에는 기본 메모리 속성 설정이 있다  
	- MPU가 있고 지역이 기본 값과 다르게 프로그래밍된 경우 무시할 수 있다.

### 메모리 접근의 특징

- Bufferable
	- 메모리에 쓰기는 프로세서가 다음 명령 실행을 계속하는 동안 쓰기 버퍼에 의해 수행될 수 있다.  
- Cacheable
	- 메모리 읽기에서 얻은 데이터는 메모리 캐시에 복사되어 다음에 접근할 때 캐시에서 값을 얻어 프로그램 실행 속도를 높일 수 있다.  
- Executable
	- 프로세서는 이 메모리 영역으로부터 프로그램 코드를 패치하고 실행할 수 있다.  
- Sharable
	- 이 메모리 영역 내의 데이터는 다수의 버스 마스터들에 의해 공유될 수 있다. 
	- 메모리 시스템은 공유 가능한 메모리 영역 내의 상이한 버스 마스터들 간의 데이터의 일관성을 보장할 필요가 있다.

|영역명|주소|목적|Cacheable|Executable,buffered|
|---|---|---|---|---|
|코드 메모리 영역|0x00000000~0x1FFFFFFF|코드, 데이터|O|O,O|
|SRAM 메모리 영역|0x20000000~0x3FFFFFFF|On-chip RAM|O|O,O|
|주변기기 영역|0x40000000~0x5FFFFFFF|주변기기|X|X,0|
|외부 RAM 영역|0x60000000~0x7FFFFFFF|On-chip 아니면 Off-chip 메모리 영역|O|O,O|
|외부 RAM 영역|0x80000000~0x9FFFFFFF|On-chip 아니면 Off-chip 메모리 영역|O|O,O|
|외부 기기|0xA0000000~0xBFFFFFFF|외부기기나 공유된 메모리|X|X,X|
|외부 기기|0xC0000000~0xDFFFFFFF|외부기기나 공유된 메모리|X|X,X|
|시스템 영역|0xE0000000~0xFFFFFFFF|private 주변기기나 제조사 특별 기기|X|X,X|

### 메모리 접근 권한 기본값

- Cortex-M3 메모리 맵에는 메모리 액세스 권한에 대한 기본 구성이 있다  
- 기본 메모리 액세스 권한은 다음과 같은 경우에 사용된다 :  
	1. MPU가 없다  
	2. MPU가 있지만 비활성화됨  
- 그렇지 않으면 MPU는 메모리 액세스가 허용되는지 여부를 결정할 것이다  
- 메모리 액세스가 차단되면 오류 예외가 즉시 발생한다

|영역명|주소|엑세스|
|-|-|-|
|제조사 특정|0xE0100000~0xFFFFFFFF|접근가능|
|ETM|0xE0041000~0xE0041FFF|차단됨, 유저의 접근은 bus fault로 이어짐|
|TPIU|0xE0040000~0xE0040FFF|차단됨, 유저의 접근은 bus fault로 이어짐|
|내부 PPB|0xE000F000~0xE0003FFF|차단됨, 유저의 접근은 bus fault로 이어짐|
|SCS|0xE000E000~0xE000EFFF|차단됨, 유저의 접근은 bus fault로 이어짐|
|FPB|0xE0002000~0xE0003FFF|차단됨, 유저의 접근은 bus fault로 이어짐|
|DWT|0xE0001000~0xE0001FFF|차단됨, 유저의 접근은 bus fault로 이어짐|
|ITM|0xE0000000~0xE0000FFF|읽기전용; 유저엑세스 허용을 해놓은 stimulus port 이외에는 쓰기 제한됨|
|외부 RAM|0x60000000~0x9FFFFFFF|접근가능|
|주변기기|0x40000000~0x5FFFFFFF|접근가능|
|SRAM|0x20000000~0x3FFFFFFF|접근가능|
|코드영역|0x00000000~0x1FFFFFFF|접근가능|
